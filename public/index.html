<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sora Watermark Cleaner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Remove Sora short-video watermark online. Paste URL or upload a short video (≤10s, ≤30MB). Fast, clean, privacy-friendly.">
  <meta name="api-base" content="https://removesorawatermark.onrender.com">
  <link rel="icon" href="data:,">
  <style>
    /* Subtle Apple-like vibe + a bit of glass */
    .glass {
      background: rgba(255,255,255,0.7);
      backdrop-filter: saturate(180%) blur(12px);
    }
    .gradient {
      background: radial-gradient(1200px 600px at 10% 20%, rgba(99,102,241,0.15), transparent 50%),
                  radial-gradient(800px 400px at 90% 10%, rgba(16,185,129,0.15), transparent 50%);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 gradient text-gray-900">
  <header class="w-full">
    <div class="max-w-6xl mx-auto px-6 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded-xl bg-black"></div>
        <span class="font-semibold text-lg">Sora Watermark Cleaner</span>
      </div>
      <nav class="text-sm text-gray-600">
        <a href="#features" class="hover:text-gray-900 mr-6">Features</a>
        <a href="#tech" class="hover:text-gray-900 mr-6">Tech</a>
        <a href="#showcase" class="hover:text-gray-900 mr-6">Showcase</a>
        <a href="#qa" class="hover:text-gray-900">Q&A</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6">
    <!-- Hero -->
    <section class="mt-10 mb-8">
      <div class="glass rounded-3xl p-8 shadow-sm">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">Remove Sora watermark in seconds</h1>
            <p class="mt-4 text-gray-700">Paste the Sora video URL or upload a short clip (≤10s, ≤30MB). Your converted video is stored temporarily.</p>
            <div class="mt-6 flex items-center gap-3">
              <button id="btnScrollUrl" class="px-4 py-2 rounded-xl bg-black text-white hover:bg-gray-800 transition">Paste URL</button>
              <button id="btnScrollUpload" class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-900 hover:bg-gray-100 transition">Upload Video</button>
            </div>
          </div>
          <div class="rounded-2xl overflow-hidden border border-gray-200">
            <video id="heroVideo" class="w-full h-64 object-cover bg-black" controls muted playsinline>
              <!-- Placeholder poster -->
            </video>
          </div>
        </div>
      </div>
    </section>

    <!-- URL Mode -->
    <section id="urlSection" class="mt-10">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Remove via URL</h2>
        <p class="mt-2 text-sm text-gray-600">Paste a Sora video URL below. Click Clear to reset the input.</p>
        <div class="mt-4 flex gap-3">
          <input id="urlInput" type="url" placeholder="https://example.com/sora-video.mp4" class="flex-1 px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-black" />
          <button id="btnClearUrl" class="px-4 py-3 rounded-xl border border-gray-200 hover:bg-gray-100">Clear</button>
          <button id="btnSubmitUrl" class="px-4 py-3 rounded-xl bg-black text-white hover:bg-gray-800">Remove Watermark</button>
        </div>
        <p id="urlHint" class="mt-2 text-xs text-gray-500">We process the video via Replicate API. Converted files are temporary.</p>
        <!-- API health diagnostic -->
        <div class="mt-3 flex items-center gap-3 text-xs">
          <button id="apiHealthBtn" class="px-3 py-2 rounded-lg bg-black text-white hover:bg-gray-800">Check API Health</button>
          <span id="apiHealthOut" class="text-gray-600">Backend: auto-detected</span>
        </div>
      </div>
    </section>

    <!-- Upload Mode with toggle -->
    <section id="uploadSection" class="mt-10">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Remove via Upload</h2>
        <p class="mt-2 text-sm text-gray-600">Upload a short video (MOV/MP4 etc., ≤10s, ≤30MB) or paste a URL.</p>

        <!-- Tabs -->
        <div class="mt-4 flex gap-2">
          <button id="tabUpload" class="px-4 py-2 rounded-xl bg-black text-white hover:bg-gray-800">Upload</button>
          <button id="tabPasteUrl" class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-900 hover:bg-gray-100">Paste URL</button>
        </div>

        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <!-- Left column: Upload block -->
          <div id="uploadBlock" class="border border-dashed border-gray-300 rounded-2xl p-6 text-center">
            <input id="fileInput" type="file" accept="video/mp4,video/quicktime,video/*" class="hidden" />
            <div class="flex flex-col items-center">
              <div class="h-16 w-16 rounded-xl bg-gray-200 mb-3"></div>
              <p class="text-gray-700">Drag & drop your video here</p>
              <p class="text-xs text-gray-500">or</p>
              <button id="btnPickFile" class="mt-2 px-4 py-2 rounded-xl bg-white border border-gray-200 hover:bg-gray-100">Choose File</button>
            </div>
          </div>

          <!-- Right column: preview & submit (unchanged) -->
          <div class="flex flex-col">
            <video id="uploadPreview" class="w-full h-48 bg-black rounded-xl" controls muted></video>
            <div class="mt-3 flex gap-3">
              <button id="btnSubmitUpload" class="px-4 py-3 rounded-xl bg-black text-white hover:bg-gray-800">Remove Watermark</button>
              <span id="uploadInfo" class="text-xs text-gray-500 self-center">File ≤30MB & duration ≤10s</span>
            </div>
          </div>
        </div>

        <!-- Paste URL block (hidden by default) -->
        <div id="pasteUrlBlock" class="mt-4 hidden">
          <div class="rounded-2xl border border-gray-200 p-4">
            <h3 class="text-sm font-medium text-gray-700 mb-2">Paste a Sora video URL</h3>
            <div class="flex gap-2">
              <input id="uploadUrlInput" type="url" placeholder="https://example.com/sora-video.mp4" class="flex-1 px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-black" />
              <button id="btnClearUploadUrl" class="px-4 py-3 rounded-xl border border-gray-200 hover:bg-gray-100">Clear</button>
              <button id="btnSubmitUrlUpload" class="px-4 py-3 rounded-xl bg-black text-white hover:bg-gray-800">Remove Watermark</button>
            </div>
            <p class="mt-2 text-xs text-gray-500">We process the video via Replicate API. Converted files are temporary.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Result -->
    <section id="resultSection" class="mt-10 hidden">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Result</h2>
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <div>
            <h3 class="text-sm font-medium text-gray-600">Before</h3>
            <video id="beforeVideo" class="w-full h-64 bg-black rounded-xl" controls></video>
          </div>
          <div>
            <h3 class="text-sm font-medium text-gray-600">After</h3>
            <video id="afterVideo" class="w-full h-64 bg-black rounded-xl" controls></video>
          </div>
        </div>
        <div id="logsBox" class="mt-4 text-xs text-gray-500 whitespace-pre-wrap"></div>
      </div>
    </section>

    <!-- Features (from open-source project intro) -->
    <section id="features" class="mt-12">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Why this watermark remover</h2>
        <ul class="mt-3 list-disc pl-6 text-gray-700">
          <li>Purpose-built for Sora short-video watermark patterns</li>
          <li>Fast processing via cloud inference, minimal waiting</li>
          <li>Preserves visual quality while removing overlays</li>
          <li>Simple workflow: paste URL or upload, one click to clean</li>
          <li>Temporary storage; we do not retain your converted videos</li>
        </ul>
      </div>
    </section>

    <!-- Tech advantages -->
    <section id="tech" class="mt-12">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Technical advantages</h2>
        <ul class="mt-3 list-disc pl-6 text-gray-700">
          <li>Leverages the open-source SoraWatermarkCleaner pipeline</li>
          <li>Optimized inference through Replicate API for reliability and scale</li>
          <li>Frame-wise processing tailored to watermark regions</li>
          <li>Client-side constraints to ensure fast turnaround</li>
          <li>Stateless backend; uploads proxied and discarded post-processing</li>
        </ul>
      </div>
    </section>

    <!-- Showcase -->
    <section id="showcase" class="mt-12">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Before & After showcase</h2>
        <p class="mt-2 text-sm text-gray-600">Compare original and cleaned output side-by-side.</p>
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <video class="w-full h-64 bg-black rounded-xl" controls></video>
          <video class="w-full h-64 bg-black rounded-xl" controls></video>
        </div>
      </div>
    </section>

    <!-- Q&A -->
    <section id="qa" class="mt-12">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-xl font-semibold">Q&A</h2>
        <div class="mt-3 space-y-3">
          <details class="rounded-xl border border-gray-200 p-4">
            <summary class="font-medium cursor-pointer">Do you store my video?</summary>
            <p class="mt-2 text-sm text-gray-700">Converted videos are stored temporarily for processing. We do not retain them long-term.</p>
          </details>
          <details class="rounded-xl border border-gray-200 p-4">
            <summary class="font-medium cursor-pointer">What formats are supported?</summary>
            <p class="mt-2 text-sm text-gray-700">MOV, MP4 and other common web-playable formats. Keep under 10 seconds and 30MB.</p>
          </details>
          <details class="rounded-xl border border-gray-200 p-4">
            <summary class="font-medium cursor-pointer">How long does processing take?</summary>
            <p class="mt-2 text-sm text-gray-700">Usually seconds to a minute, depending on queue and video length.</p>
          </details>
          <details class="rounded-xl border border-gray-200 p-4">
            <summary class="font-medium cursor-pointer">Is it free?</summary>
            <p class="mt-2 text-sm text-gray-700">Processing consumes API credits on Replicate. Pricing depends on your plan.</p>
          </details>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-12 mb-10">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 text-sm text-gray-600">
        <div>© 2025 Sora Watermark Cleaner</div>
        <div class="flex gap-6">
          <a href="#" class="hover:text-gray-900">User Agreement</a>
          <a href="#" class="hover:text-gray-900">Privacy Policy</a>
          <a href="#" class="hover:text-gray-900">Content Copyright</a>
        </div>
      </div>
    </footer>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const API_BASE = (document.querySelector('meta[name="api-base"]')?.content || '').trim();
    const apiUrl = (path) => (API_BASE ? API_BASE.replace(/\/$/, '') + path : path);
    // Display current backend base to help deployment testing
    const apiBaseDisplay = API_BASE || "(relative)";
    (() => {
      if (API_BASE && API_BASE.includes("dashboard.render.com")) {
        console.warn("API_BASE points to Render dashboard, not your service URL. Use your onrender.com service URL instead, e.g. https://your-service.onrender.com");
      }
      const hint = document.getElementById("urlHint");
      if (hint) {
        hint.textContent = `We process via Replicate API through backend: ${apiBaseDisplay}. Converted files are temporary.`;
      }
    })();
    const urlInput = $("urlInput");
    const btnClearUrl = $("btnClearUrl");
    const btnSubmitUrl = $("btnSubmitUrl");
    const btnPickFile = $("btnPickFile");
    const fileInput = $("fileInput");
    const uploadPreview = $("uploadPreview");
    const btnSubmitUpload = $("btnSubmitUpload");
    // Upload module tabs & URL mode
    const tabUpload = document.getElementById("tabUpload");
    const tabPasteUrl = document.getElementById("tabPasteUrl");
    const uploadBlock = document.getElementById("uploadBlock");
    const pasteUrlBlock = document.getElementById("pasteUrlBlock");
    const uploadUrlInput = document.getElementById("uploadUrlInput");
    const btnClearUploadUrl = document.getElementById("btnClearUploadUrl");
    const btnSubmitUrlUpload = document.getElementById("btnSubmitUrlUpload");
    const resultSection = $("resultSection");
    const beforeVideo = $("beforeVideo");
    const afterVideo = $("afterVideo");
    const logsBox = $("logsBox");
    const btnScrollUrl = $("btnScrollUrl");
    const btnScrollUpload = $("btnScrollUpload");

    btnScrollUrl.addEventListener("click", () => {
      document.getElementById("urlSection").scrollIntoView({ behavior: "smooth", block: "start" });
      urlInput.focus();
    });
    btnScrollUpload.addEventListener("click", () => {
      document.getElementById("uploadSection").scrollIntoView({ behavior: "smooth", block: "start" });
    });

    btnClearUrl.addEventListener("click", () => {
      urlInput.value = "";
      urlInput.focus();
    });

    btnSubmitUrl.addEventListener("click", async () => {
      const url = urlInput.value.trim();
      if (!url) {
        alert("Please paste a valid video URL.");
        return;
      }
      setLoading(true);
      try {
        const resp = await fetch(apiUrl("/api/remove"), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || "Request failed");
        showResult(url, data);
      } catch (e) {
        alert(e.message || "Error");
      } finally {
        setLoading(false);
      }
    });

    btnPickFile.addEventListener("click", () => fileInput.click());

    // Toggle tabs in upload section
    tabUpload.addEventListener("click", () => {
      tabUpload.className = "px-4 py-2 rounded-xl bg-black text-white hover:bg-gray-800";
      tabPasteUrl.className = "px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-900 hover:bg-gray-100";
      uploadBlock.classList.remove("hidden");
      pasteUrlBlock.classList.add("hidden");
    });
    tabPasteUrl.addEventListener("click", () => {
      tabPasteUrl.className = "px-4 py-2 rounded-xl bg-black text-white hover:bg-gray-800";
      tabUpload.className = "px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-900 hover:bg-gray-100";
      uploadBlock.classList.add("hidden");
      pasteUrlBlock.classList.remove("hidden");
      uploadUrlInput.focus();
    });

    btnClearUploadUrl.addEventListener("click", () => {
      uploadUrlInput.value = "";
      uploadUrlInput.focus();
    });

    // drag & drop
    const dropZone = btnPickFile.closest("div.border");
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("bg-gray-50");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("bg-gray-50"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("bg-gray-50");
      const file = e.dataTransfer.files?.[0];
      if (file) handleFileSelected(file);
    });

    fileInput.addEventListener("change", () => {
      const file = fileInput.files?.[0];
      if (file) handleFileSelected(file);
    });

    function handleFileSelected(file) {
      // size check
      const maxSize = 30 * 1024 * 1024;
      if (file.size > maxSize) {
        alert("File too large. Please keep under 30MB.");
        fileInput.value = "";
        return;
      }
      // preview and duration check
      const url = URL.createObjectURL(file);
      uploadPreview.src = url;
      uploadPreview.onloadedmetadata = () => {
        if (uploadPreview.duration && uploadPreview.duration > 10.5) {
          alert("Video too long. Please keep under 10 seconds.");
          fileInput.value = "";
          uploadPreview.src = "";
        }
      };
    }

    btnSubmitUpload.addEventListener("click", async () => {
      const file = fileInput.files?.[0];
      if (!file) {
        alert("Please choose a video file.");
        return;
      }
      setLoading(true);
      try {
        const form = new FormData();
        form.append("file", file, file.name);
        const resp = await fetch(apiUrl("/api/remove"), { method: "POST", body: form });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || "Request failed");
        const fileUrl = uploadPreview.src; // local blob URL for 'before'
        showResult(fileUrl, data);
      } catch (e) {
        alert(e.message || "Error");
      } finally {
        setLoading(false);
      }
    });

    // Submit for URL mode inside upload section
    btnSubmitUrlUpload.addEventListener("click", async () => {
      const url = uploadUrlInput.value.trim();
      if (!url) {
        alert("Please paste a valid video URL.");
        return;
      }
      setLoading(true);
      try {
        const resp = await fetch(apiUrl("/api/remove"), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || "Request failed");
        showResult(url, data);
      } catch (e) {
        alert(e.message || "Error");
      } finally {
        setLoading(false);
      }
    });

    function showResult(beforeUrl, data) {
      resultSection.classList.remove("hidden");
      beforeVideo.src = beforeUrl;
      const output = data.output;
      // model output can be a single URL or array of URLs
      let afterUrl = null;
      if (Array.isArray(output)) {
        afterUrl = output[output.length - 1];
      } else if (typeof output === "string") {
        afterUrl = output;
      } else if (output && output.video) {
        afterUrl = output.video;
      }
      afterVideo.src = afterUrl || "";
      logsBox.textContent = data.logs || "";
      afterVideo.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function setLoading(loading) {
      btnSubmitUrl.disabled = loading;
      btnSubmitUpload.disabled = loading;
      if (typeof btnSubmitUrlUpload !== "undefined" && btnSubmitUrlUpload) {
        btnSubmitUrlUpload.disabled = loading;
      }

      const label = loading ? "Processing..." : "Remove Watermark";
      btnSubmitUrl.textContent = label;
      btnSubmitUpload.textContent = label;
      if (typeof btnSubmitUrlUpload !== "undefined" && btnSubmitUrlUpload) {
        btnSubmitUrlUpload.textContent = label;
      }
    }
  </script>
  <script>
    // Lightweight API health checker to diagnose Render connectivity
    (function () {
      const API_BASE = (document.querySelector('meta[name="api-base"]')?.content || '').trim();
      const apiUrl = (path) => (API_BASE ? API_BASE.replace(/\/$/, '') + path : path);
      const btn = document.getElementById("apiHealthBtn");
      const out = document.getElementById("apiHealthOut");
      if (!btn || !out) return;

      const show = (text, ok) => {
        out.textContent = text;
        out.className = ok ? "text-green-600" : "text-red-600";
      };

      const check = async () => {
        const ctrl = new AbortController();
        const t = setTimeout(() => ctrl.abort(), 15000);
        out.className = "text-gray-600";
        out.textContent = `Checking ${API_BASE || "(relative)"}...`;
        try {
          const resp = await fetch(apiUrl("/api/health"), { signal: ctrl.signal });
          const status = resp.status;
          const type = resp.headers.get("content-type") || "";
          let bodyText = "";
          try { bodyText = await resp.text(); } catch {}
          clearTimeout(t);
          if (status === 200 && type.includes("application/json")) {
            show(`OK 200 JSON: ${bodyText}`, true);
          } else {
            show(`HTTP ${status} ${type || ""} ${bodyText.slice(0, 120)}`, false);
          }
        } catch (e) {
          clearTimeout(t);
          show(`Network error: ${e?.message || e}`, false);
        }
      };

      // init line shows current backend
      out.textContent = `Backend: ${API_BASE || "(relative to same origin)"}`;
      if (API_BASE.includes("dashboard.render.com")) {
        console.warn("API_BASE points to Render dashboard, not your service URL. Use your onrender.com service URL instead.");
      }
      btn.addEventListener("click", check);
    })();
  </script>
</body>
</html>
